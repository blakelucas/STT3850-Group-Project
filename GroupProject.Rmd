---
title: "Group Project"
author: "Blake Lucas & Brendan Davis"
---

# Project Description
{description of project}

+ Iouzipcodes
```{r, include=FALSE, echo=FALSE}
library(gtools) #used for binomial search of zip code lat/lon
library(dplyr)
library(ggplot2)
```
```{r, echo=FALSE}

site <- "iouzipcodes2015.csv"
iouZips <- read.csv(file = site)
head(iouZips, n = 10) # show first five rows

#number of iouZips by state
iouZips %>% 
	group_by(state) %>% 
	summarise(count = n()) %>% 
	ggplot(aes(x = reorder(state,(-count)), y = count)) + 
		geom_bar(stat = 'identity')
```

+ NonIouzipcodes
```{r, echo=FALSE}
site <- "noniouzipcodes2015.csv"
nonIouZips <- read.csv(file = site)
head(nonIouZips, n = 1) # show first five rows

#number of noniouZips by state
nonIouZips %>% 
	group_by(state) %>% 
	summarise(count = n()) %>% 
	ggplot(aes(x = reorder(state,(-count)), y = count)) + 
		geom_bar(stat = 'identity')
```

+ ZipCode latitude and longitation
```{r, echo=FALSE}
site <- "zipcodelatlon.csv"
zipsLocation <- read.csv(file = site)
head(zipsLocation, n = 5) # show first five rows

#These two functions allow you to search a zipcodes Latitude, first is a helper function
subFun <- function(x) {
  return (zipsLocation$ZIP[[x]])
}
findLat <- function(zip)
{
  i <- zipsLocation$Latitude[[binsearch(fun = subFun, range = c(1,nrow(zipsLocation)), target = zip)$where[1]]]
  return (i)
} 
findLon <- function(zip)
{
  i <- zipsLocation$Longitude[[binsearch(fun = subFun, range = c(1,nrow(zipsLocation)), target = zip)$where[1]]]
  return (i)
} 

#First iouZips
iouZipsLoc <- 
  mutate(iouZips, lat = -1, lon = -1)
#nrow(iouZipsLoc)
for (i in 1:52614)
{
  iouZipsLoc$lat[[i]] <- findLat(iouZipsLoc$zip[[i]])
  iouZipsLoc$lon[[i]] <- findLon(iouZipsLoc$zip[[i]])
}
#Then nonIouZips
nonIouZipsLoc <- 
  mutate(nonIouZips, lat = -1, lon = -1)
nrow(nonIouZips)
for (i in 1:34014)
{
  nonIouZipsLoc$lat[[i]] <- findLat(nonIouZipsLoc$zip[[i]])
  nonIouZipsLoc$lon[[i]] <- findLon(nonIouZipsLoc$zip[[i]])
}



head(iouZipsLoc, 2)
head(nonIouZips, 2)
#TODO: Get a hypothesis for our data before we get too far
```











Coordinate Heatmap
```{r}
# !! NOTE: !!
# This is currently just plotting ALL of the zip code coordinates in the
#  zip lat lon CSV. Need to apply those coordinates to each
#  row of our main data based on ZIP
#
#  The arithmetic for the heat map is commented out since it may
#  take a while to run.


# References: 
# https://axelhodler.medium.com/creating-a-heat-map-from-coordinates-using-r-780db4901075
# https://github.com/axelhodler/heator/blob/master/README.md
# http://maps.stamen.com/#terrain/12/37.7706/-122.3782

library(ggmap)
library(RColorBrewer)

# Make table of just coordinates
coords.data <- read.csv(file="./zipcodelatlon.csv")
coords.data <- subset(coords.data, select=-c(ZIP))

# Define bounds of USA
map_bounds <- c(left = -124.74, bottom = 24.53, right = -66.95, top = 49.4)

# Configure map, bounds, zoom, & style
coords.map <- get_stamenmap(map_bounds, zoom=7, maptype="toner-lite")

# Logic for rendering heatmap
coords.map <- ggmap(coords.map, extent="device", legend="none")
coords.map <- coords.map + stat_density2d(data=coords.data,  aes(x=Longitude, y=Latitude, fill=..level.., alpha=..level..), geom="polygon")
coords.map <- coords.map +   scale_fill_gradientn(colours=rev(brewer.pal(7, "Spectral")))

# Output map
coords.map <- coords.map + theme_bw()
ggsave(filename="./heat.png")


```

![alt text here](./heat.png)
