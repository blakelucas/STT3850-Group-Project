---
title: "Group Project"
author: "Blake Lucas & Brendan Davis"
---

# Project Description
{description of project}

+ Iouzipcodes
```{r, include=FALSE, echo=FALSE}
library(gtools) #used for binomial search of zip code lat/lon
library(dplyr)
library(ggplot2)
```
```{r, echo=FALSE, eval=FALSE}
site <- "iouzipcodes2015.csv"
iouZips <- read.csv(file = site)
head(iouZips, n = 10) # show first five rows

#number of iouZips by state
iouZips %>% 
	group_by(state) %>% 
	summarise(count = n()) %>% 
	ggplot(aes(x = reorder(state,(-count)), y = count)) + 
		geom_bar(stat = 'identity')
```
+ NonIouzipcodes
```{r, echo=FALSE, eval=FALSE}
site <- "noniouzipcodes2015.csv"
nonIouZips <- read.csv(file = site)
head(nonIouZips, n = 1) # show first five rows

#number of noniouZips by state
nonIouZips %>% 
	group_by(state) %>% 
	summarise(count = n()) %>% 
	ggplot(aes(x = reorder(state,(-count)), y = count)) + 
		geom_bar(stat = 'identity')
```

+ ZipCode latitude and longitation
```{r, echo=FALSE, eval=FALSE}
site <- "zipcodelatlon.csv"
zipsLocation <- read.csv(file = site)
head(zipsLocation, n = 5) # show first five rows

#These two functions allow you to search a zipcodes Latitude, first is a helper function
subFun <- function(x) {
  return (zipsLocation$ZIP[[x]])
}
findLat <- function(zip)
{
  i <- zipsLocation$Latitude[[binsearch(fun = subFun, range = c(1,nrow(zipsLocation)), target = zip)$where[1]]]
  return (i)
} 
findLon <- function(zip)
{
  i <- zipsLocation$Longitude[[binsearch(fun = subFun, range = c(1,nrow(zipsLocation)), target = zip)$where[1]]]
  return (i)
} 

#First iouZips
iouZipsLoc <- 
  mutate(iouZips, lat = -1, lon = -1)
#nrow(iouZipsLoc)
for (i in 1:52614)
{
  iouZipsLoc$lat[[i]] <- findLat(iouZipsLoc$zip[[i]])
  iouZipsLoc$lon[[i]] <- findLon(iouZipsLoc$zip[[i]])
}
#Then nonIouZips
nonIouZipsLoc <- 
  mutate(nonIouZips, lat = -1, lon = -1)
nrow(nonIouZips)
for (i in 1:34014)
{
  nonIouZipsLoc$lat[[i]] <- findLat(nonIouZipsLoc$zip[[i]])
  nonIouZipsLoc$lon[[i]] <- findLon(nonIouZipsLoc$zip[[i]])
}

head(iouZipsLoc, 2)
head(nonIouZipsLoc, 2)

allZipsLoc <- rbind(iouZipsLoc, nonIouZipsLoc)


write.csv(allZipsLoc, "./zipData.csv", row.names = FALSE)
#TODO: Get a hypothesis for our data before we get too far
```


Coordinate Heatmap
```{r, echo=FALSE, eval=FALSE}
>>>>>>> c9f1ce20223d61870ccc9e69ecf55aa7e5b72a47
# References: 
# https://axelhodler.medium.com/creating-a-heat-map-from-coordinates-using-r-780db4901075
# https://github.com/axelhodler/heator/blob/master/README.md
# http://maps.stamen.com/#terrain/12/37.7706/-122.3782

library(ggmap)
library(RColorBrewer)

# Make table of just coordinates
coords.data <- read.csv(file="./zipData.csv")
coords.data <- subset(coords.data, select=c(lat,lon))
names(coords.data)[names(coords.data) == 'lon'] <- 'Longitude'
names(coords.data)[names(coords.data) == 'lat'] <- 'Latitude'

# Define bounds of USA
map_bounds <- c(left = -124.8, bottom = 24.6, right = -67, top = 49.5)

# Configure map, bounds, zoom, & style
coords.map <- get_stamenmap(map_bounds, zoom=7, maptype="toner-lite")

# Logic for rendering heatmap
coords.map <- ggmap(coords.map, extent="device", legend="none")
coords.map <- coords.map + stat_density2d(data=coords.data,  aes(x=Longitude, y=Latitude, fill=..level.., alpha=..level..), geom="polygon")
coords.map <- coords.map +   scale_fill_gradientn(colours=rev(brewer.pal(7, "Spectral")))

# Output map
coords.map <- coords.map + theme_bw()
ggsave(filename="./heat.png")
```

![alt text here](./heat.png)

Plotting Rates
```{r}
allZipsLoc <- read.csv(file = "zipData.csv")
# Rate histograms

# Commercial
ggplot(allZipsLoc, aes(x=comm_rate)) +
  geom_histogram(aes(y=..density..), bins=150) +
  geom_density(alpha=.2, color="dodgerblue1") +
  geom_vline(aes(xintercept=mean(comm_rate)),
            color="orange", linetype="dashed", size=1) +
  xlim(.001,.4)

# Industrial
ggplot(allZipsLoc, aes(x=ind_rate)) +
  geom_histogram(bins=150) +
  geom_vline(aes(xintercept=mean(ind_rate)),
            color="orange", linetype="dashed", size=1) +
  xlim(.001,.4)

# Residential
ggplot(allZipsLoc, aes(x=res_rate)) +
  geom_histogram(bins=150) +
  geom_vline(aes(xintercept=mean(res_rate)),
            color="orange", linetype="dashed", size=1) +
  xlim(.001,.38)

```

Hypothesis Testing
```{r}
library(tidyverse)
library(infer)




```